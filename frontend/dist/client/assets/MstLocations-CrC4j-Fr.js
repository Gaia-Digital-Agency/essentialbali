import{r as s,e as V,j as e,C as fe,D as be,E as ve,F as Se}from"./AdminApp-ChTaPRE2.js";import{P as Ne}from"./PageBreadCrumb-DPyHZSFF.js";import{P as Te}from"./PageMeta-B5tbE7tJ.js";import{C as ee}from"./ComponentCard-BXAeiW9m.js";import{I as W}from"./InputField-Btjg0xJq.js";import{L as j}from"./Label-Bw_W4V5I.js";import{B as $}from"./Button-BkWwhKN1.js";import{A as X}from"./Alert-Cd3KaBGt.js";import{S as ke}from"./download-D45ZpCqd.js";import{u as Z}from"./useTimedMessage-D8LL_2fq.js";import{S as A}from"./Select-BrOugipn.js";import{t as q}from"./slugify-CPdjgS2J.js";import{u as G}from"./useModal-B0ZwIyJt.js";import{B as we}from"./Badge-CwbRsx9y.js";import{M as Le,g as Ce}from"./ModalTimezoneTable-DpNs8PnS.js";import{u as De}from"./useNavigationPrompt-B_4aje__.js";import{A as J}from"./FeaturedImage-C43VoFVu.js";import{T as Ae,a as ze,b as Q,c as l,d as Ee}from"./index-DxIT6uDb.js";import{w as L}from"./sweetalert2-react-content.es-CEkjcN0-.js";import{S as C}from"./sweetalert2.esm.all-BbQndx0i.js";import{d as Me}from"./template.service-a9rTbIwN.js";import"./index-BYKjDz3i.js";import"./media.service-DnMGUgve.js";import"./MediaForm-fju4iPXC.js";import"./index-BVEKCKPu.js";import"./index-C9kMmtqa.js";import"./createLucideIcon-BRWjyiVq.js";const D="http://34.124.244.233/essentialbali",_e={country:null,city:"country",region:"city"};function Pe({selectedLocations:y,onRefresh:S}){const[g,o]=s.useState(null),[m,x]=s.useState(null),[w,z]=s.useState(!1),[E,M]=s.useState(0),[f,N]=s.useState(""),[T,b]=s.useState(""),[d,a]=s.useState(""),[c,h]=s.useState([]),[_,R]=s.useState(),[H,P]=s.useState(""),[te,ae]=s.useState([]),[se,re]=s.useState([]),[u,O]=s.useState(),[p,B]=s.useState(),{closeModal:I,openModal:U}=G(!1),{setBlock:Y}=De(),{adminTaxonomies:F}=V(),oe={country:"countries",city:"cities",region:"regions"},{isOpen:ne,openModal:ie,closeModal:le}=G(),ce=[{key:"country",value:"country",label:"Area"},{key:"city",value:"city",label:"Sub Area (City)"},{key:"region",value:"region",label:"Sub Area (Region)"}],de=t=>{a(`${t}`)},me=t=>{R(Number(t))},xe=t=>{P(String(t))},ue=()=>{ie()};s.useEffect(()=>{(async()=>{try{const r=(await Ce()).data,v={key:0,value:0,label:"Select Timezone"},i=(r==null?void 0:r.map(k=>({key:k.id,value:k.timezone_name,label:k.timezone_name+" - ["+k.utc_offset+"]"})))??[];re([v,...i]),ae(r)}catch(n){console.error(n)}})()},[]),s.useEffect(()=>{(async()=>{var n;try{const r=_e[d],v=(n=F==null?void 0:F[oe[r]])==null?void 0:n.map(i=>({key:i.id,value:i.id,label:i.name}));h(v??[])}catch(r){console.error("Failed to fetch parent locations:",r),h([])}})()},[d]),s.useEffect(()=>{if(y){const t=y;M(t.id??0),R(t.id_parent??0),N(t.name??""),a(t.typeLoc??""),b(t.slug??""),O({id:t.site_logo_id,url:`${D}/${t.site_logo}`}),B({id:t.flag_icon_id,url:`${D}/${t.flag_icon}`}),P(t.timezone??""),z(!0)}},[y]),Z(m,x),Z(g,o);const pe=()=>{N(""),b(""),P(""),O({url:"",id:void 0}),B({url:"",id:void 0})},he=async t=>{var r,v;t.preventDefault();const n={id_parent:_,name:f,slug:q(T),timezone:H,site_logo:u==null?void 0:u.id,flag_icon:p==null?void 0:p.id};try{if(w)await be(E,d,n),x(f+" is Edited Successfully");else{if(!d){o("Please select type location");return}await fe(d,n),x(f+" is Created Successfully")}pe(),S()}catch(i){i instanceof Error&&o(i.message),typeof i=="object"&&i!==null&&"response"in i&&o(((v=(r=i.response)==null?void 0:r.data)==null?void 0:v.message)??"Something went wrong")}},ye=t=>{const n=t.target.value,r=w?T:q(n);N(t.target.value),b(r)},K=({label:t,children:n})=>e.jsxs("div",{className:"input-wrapper",children:[e.jsx(j,{children:t}),n]}),ge=t=>{O({url:`${D}/${t.path}`,id:t.id}),I(),Y(!0)},je=t=>{B({url:`${D}/${t.path}`,id:t.id}),I(),Y(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(ee,{title:"Area Form",children:[e.jsx("div",{className:"mb-5",children:g&&e.jsx(X,{variant:"error",title:"Error",message:g})}),e.jsx("div",{className:"mb-5",children:m&&e.jsx(X,{variant:"success",title:"Success",message:m})}),e.jsxs("form",{onSubmit:he,children:[e.jsxs("div",{className:"space-y-3 space-x-6 grid grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(j,{children:"Area Type"}),e.jsx(A,{options:ce,value:d,placeholder:"Select area type",onChange:de,className:"dark:bg-dark-900"})]}),e.jsxs("div",{children:[e.jsx(j,{children:"Parent"}),e.jsx(A,{options:c??[],placeholder:"Select Parent",value:_,onChange:me,className:"dark:bg-dark-900"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(j,{htmlFor:"cName",children:"Name"}),e.jsx(W,{type:"text",id:"cName",onChange:ye,value:f,placeholder:"Seminyak"})]}),d==="country"&&e.jsxs("div",{className:"mb-3",children:[e.jsxs(j,{children:[e.jsx("span",{className:"mr-2",children:"Time Zone"}),e.jsx(we,{color:"info",onClick:ue,children:"?"})]}),e.jsx(A,{options:se,value:H,placeholder:"Select Timezone...",onChange:xe,className:"dark:bg-dark-900"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(j,{htmlFor:"cSlug",children:"Slug"}),e.jsx(W,{type:"text",id:"cSlug",onChange:t=>b(t.target.value),value:T,placeholder:"seminyak"})]}),e.jsx("div",{className:"w-50 h-50",children:e.jsx(K,{label:"Site Logo",children:e.jsx(J,{url:u!=null&&u.url?`${u==null?void 0:u.url}`:"#",onClick:U,onSave:ge})})}),d==="country"&&e.jsx("div",{className:"w-50 h-50",children:e.jsx(K,{label:"Flag Icon",children:e.jsx(J,{url:p!=null&&p.url?`${p==null?void 0:p.url}`:"#",onClick:U,onSave:je})})}),e.jsx("div",{className:"space-y-6 space-x-6 flex justify-end",children:e.jsx($,{startIcon:e.jsx(ke,{className:"size-5"}),className:"w-1/4",children:"Save"})})]})]}),e.jsx(Le,{isOpen:ne,onCLose:le,timezonesData:te})]})}function Oe({onEditLocation:y,onRefresh:S,refreshKey:g}){const[o,m]=s.useState(""),[x,w]=s.useState([]),{adminTaxonomies:z,generateUrlLocations:E}=V(),M={country:"countries",city:"cities",region:"regions"},f=[{key:"country",value:"country",label:"Area"},{key:"city",value:"city",label:"Sub Area (City)"},{key:"region",value:"region",label:"Sub Area (Region)"}],N=a=>{m(String(a))},T=async(a,c)=>{const h=await ve(a,c);c===999?L(C).fire({title:"Oops",text:"This is a default location, you can't edit it",icon:"info"}):(y(h.data),window.scrollTo({top:0,behavior:"smooth"}))},b=async(a,c)=>{try{return await Se(a,c),await Me(`/${E(a,c)}`),S(),!0}catch(h){return console.error(h),!1}},d=(a,c)=>{L(C).fire({title:`Are you sure to Delete ${a}?`,text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0}).then(async h=>{h.isConfirmed&&(await b(c,o)?L(C).fire({title:"Deleted!",text:"Tag has been deleted.",icon:"success"}):L(C).fire({title:"Warning",text:"Sorry, you can not delete this data",icon:"warning"}))})};return s.useEffect(()=>{(async()=>{o||m("country"),w(z[M[o]]??[])})()},[o,g]),e.jsx(e.Fragment,{children:e.jsxs(ee,{title:"Bali Areas",children:[e.jsx("div",{className:"space-y-3 space-x-6 grid grid-cols-2",children:e.jsxs("div",{children:[e.jsx(j,{children:"Area Type"}),e.jsx(A,{options:f,placeholder:"Filter area type...",onChange:N,className:"dark:bg-dark-900"})]})}),e.jsx("div",{className:"overflow-hidden rounded-xl border border-gray-200 bg-white dark:border-white/[0.05] dark:bg-white/[0.03]",children:e.jsx("div",{className:"max-w-full overflow-x-auto",children:e.jsxs(Ae,{children:[e.jsx(ze,{className:"border-b border-l-amber-800 dark:border-white/[0.05]",children:e.jsxs(Q,{children:[e.jsx(l,{isHeader:!0,className:"px-5 py-3 font-medium text-gray-500 text-start text-theme-sm dark:text-gray-400 max-w-[10px]",children:"#"}),e.jsx(l,{isHeader:!0,className:"px-5 py-3 font-medium text-gray-500 text-start text-theme-sm dark:text-gray-400 max-w-[10px]",children:"Name"}),e.jsx(l,{isHeader:!0,className:"px-5 py-3 font-medium text-gray-500 text-start text-theme-sm dark:text-gray-400",children:"Parent"}),e.jsx(l,{isHeader:!0,className:"px-5 py-3 font-medium text-gray-500 text-start text-theme-sm dark:text-gray-400",children:"Slug"}),e.jsx(l,{isHeader:!0,className:"px-5 py-3 font-medium text-gray-500 text-start text-theme-sm dark:text-gray-400",children:"Edit?"}),e.jsx(l,{isHeader:!0,className:"px-5 py-3 font-medium text-gray-500 text-start text-theme-sm dark:text-gray-400",children:"Delete"})]})}),e.jsx(Ee,{className:"divide-y divide-gray-100 dark:divide-white/[0.05]",children:x==null?void 0:x.map((a,c)=>e.jsxs(Q,{children:[e.jsx(l,{className:"px-4 py-3 text-gray-500 text-start text-theme-xl dark:text-gray-400",children:c+1}),e.jsx(l,{className:"px-4 py-3 text-gray-500 text-start text-theme-xl dark:text-gray-400",children:a.name}),e.jsx(l,{className:"px-4 py-3 text-gray-500 text-start text-theme-xl dark:text-gray-400",children:a.name_parent?a.name_parent:"-"}),e.jsx(l,{className:"px-4 py-3 text-gray-500 text-start text-theme-xl dark:text-gray-400",children:a.slug?a.slug:"-"}),e.jsx(l,{className:"px-4 py-3 text-gray-500 text-start text-theme-xl dark:text-gray-400",children:e.jsx($,{onClick:()=>T(o,a.id),size:"sm",className:"bg-green-600 hover:bg-green-700",children:"Edit"})}),e.jsx(l,{className:"px-4 py-3 text-gray-500 text-start text-theme-xl dark:text-gray-400",children:e.jsx($,{onClick:()=>d(a.name,a.id),size:"sm",className:"bg-red-400 hover:bg-red-700",children:"Delete"})})]},a.id))})]})})})]})})}function dt(){const[y,S]=s.useState(),[g,o]=s.useState(0),m=()=>{o(x=>x+1)};return e.jsxs("div",{children:[e.jsx(Te,{title:"essentialbali Admin Dashboard | Bali Areas",description:"Manage Bali areas and their CMS pages."}),e.jsx("div",{className:"grid grid-cols-1 gap-6 xl:grid-cols-1",children:e.jsxs("div",{className:"space-y-12",children:[e.jsx(Ne,{pageTitle:"Bali Areas"}),e.jsx(Pe,{selectedLocations:y,onRefresh:m}),e.jsx(Oe,{onEditLocation:S,refreshKey:g,onRefresh:m})]})})]})}export{dt as default};
